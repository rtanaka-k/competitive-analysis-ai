# 競合分析AI v2.5 - Few-Shot Examples強化版

## 🎯 問題の本質

**v2.4まで**: システムプロンプトで「表形式で出力しろ」と指示
**v2.5**: 実際の出力例を見せる（Few-Shot Learning）

→ AIは**言葉で説明されるより、実例を見た方が理解する**

---

## ✅ v2.5の新機能

### 1. プロンプト冒頭に具体例を追加

**追加内容**:
```
【正しい出力例】
## MARKET_ANALYSIS
### 市場規模とトレンド

| 項目 | FGO | モンスターストライク |
|------|-----|-------------------|
| 推定年間売上 | 950億円（市場データ） | 800億円（目標） |
| 市場ランキング | TOP 3（年間・国内モバイル） | TOP 10（目標） |
| DAU/MAU | 150万人/400万人（推定） | 100万人/300万人（目標） |

【誤った出力例 - これは禁止】
## MARKET_ANALYSIS
### 市場規模とトレンド

FGOの推定年間売上は950億円です。
モンスターストライクの目標年間売上は800億円です。

→ このようなテキスト形式は絶対禁止です！
```

### 2. バージョン表示をv2.5に更新

```
競合分析AI v2.5 (Few-Shot Enhanced)
```

---

## 🚀 デプロイ手順

### Step 1: ファイルの置き換え

```bash
# 新しいファイルを competitive_analysis_dual_full.py として保存
# GitHubリポジトリにアップロード

git add competitive_analysis_dual_full.py
git commit -m "v2.5: Few-Shot Examples追加"
git push origin main
```

### Step 2: Streamlit Cloudで再起動

```
1. https://share.streamlit.io/
2. アプリを開く
3. 右上「⋮」→「Reboot app」
4. 1-2分待機
```

### Step 3: ブラウザのキャッシュをクリア

```
Chrome/Edge: Ctrl + Shift + Delete
Mac: Cmd + Shift + Delete

または強制リロード:
Ctrl + F5 (Windows)
Cmd + Shift + R (Mac)
```

### Step 4: 動作確認

```
✅ フッターが「v2.5」になっている
✅ 分析を実行
✅ 表形式で出力される
✅ 自社スコアが記載される
```

---

## 📊 Few-Shot Learningとは

### 定義

AIに「こうやって出力してほしい」という**実例**を見せる手法

### なぜ効果的？

```
❌ 「表形式で出力してください」← 抽象的
✅ | 項目 | 値1 | 値2 | ← 具体的
```

AIは抽象的な指示より、**具体例**の方を理解しやすい

### v2.4 vs v2.5

**v2.4（システムプロンプト強化）**:
```
「すべての情報は必ずMarkdown表形式で出力すること」
→ 言葉で説明
```

**v2.5（Few-Shot Examples追加）**:
```
「【正しい出力例】
| 項目 | FGO | モンスターストライク |
|------|-----|-------------------|
| 推定年間売上 | 950億円 | 800億円 |」
→ 実例を見せる
```

---

## 🎯 期待される改善効果

### v2.1（元のバージョン）
```
❌ システムプロンプトが弱い
❌ 具体例なし
結果: AIが指示を無視 → テキスト形式
```

### v2.4（システムプロンプト強化）
```
✅ システムプロンプト強化
❌ 具体例なし
結果: 改善されたが、まだ不完全
```

### v2.5（Few-Shot Examples追加）
```
✅ システムプロンプト強化
✅ 具体例あり（正解と不正解の両方）
結果: 大幅改善が期待される
```

---

## 🔍 トラブルシューティング

### Q1: 依然として表形式にならない

**可能性1**: AIの確率的な振る舞い

```
解決: 分析を2-3回実行してみる
（AIの出力は毎回異なる）
```

**可能性2**: 入力データ不足

```
解決: 自社タイトル情報をより詳細に入力
✅ 売上目標: 50億円
✅ DAU/MAU目標: 10万人/30万人
✅ 詳細情報: 強み、差別化ポイント
```

**可能性3**: モデルの限界

```
Claude Sonnet 4でも100%従うわけではない
→ これが現状のLLMの限界
```

---

### Q2: 自社スコアが依然として空欄

**原因**: 入力データが少なすぎる

**解決策**:

```
最低限必要な入力:
1. 自社タイトル名
2. ジャンル
3. プラットフォーム
4. 売上目標（数値）
5. DAU/MAU目標（数値）
6. 詳細情報（強み・差別化ポイント）

良い例:
自社タイトル: Game X
ジャンル: RPG
プラットフォーム: iOS, Android
売上目標: 初年度50億円
DAU/MAU目標: 10万人/30万人
詳細情報: 
- オリジナルIP
- 独自の協力プレイシステム
- リアルタイムPvP機能
- 有名イラストレーター起用
```

---

### Q3: 一部は表形式、一部はテキスト形式

**これは正常です**

```
AIは長い出力を生成する際、
途中で「モード」が変わることがあります。

対策:
1. 分析を再実行
2. プロンプトをさらに強化（次のバージョンで）
3. より具体的な入力データを提供
```

---

## 📈 さらなる改善案（v2.6以降）

### 1. Temperature調整

```python
# より決定論的な出力
message = client.messages.create(
    temperature=0.2,  # 0.7 → 0.2
    ...
)
```

### 2. 出力フォーマットの検証

```python
# 表形式でない場合、AIに再生成を依頼
if '|' not in result or result.count('|') < 100:
    # 再生成
    message = client.messages.create(
        messages=[
            {"role": "user", "content": prompt},
            {"role": "assistant", "content": result},
            {"role": "user", "content": "申し訳ありませんが、表形式で出力してください。"}
        ]
    )
```

### 3. Structured Outputsの利用（Claude 3.5以降）

```python
# 構造化された出力を強制
response_format={
    "type": "json_schema",
    "json_schema": {...}
}
```

---

## 💡 重要なポイント

### LLMの限界を理解する

```
✅ Few-Shot Examplesは効果的
✅ システムプロンプトの強化も効果的
✅ しかし100%の保証はない

これがLLM（大規模言語モデル）の特性です。
```

### 期待値の調整

```
v2.1: 表形式率 20%
v2.4: 表形式率 50-60%
v2.5: 表形式率 70-80%（期待）

100%は現状のLLM技術では困難
```

---

## 🎉 まとめ

### v2.5の改善内容

```
✅ プロンプト冒頭にFew-Shot Examples追加
✅ 正しい例と誤った例の両方を提示
✅ バージョン表示をv2.5に更新
✅ システムプロンプトはv2.4のまま維持
```

### デプロイ後の確認事項

```
1. ✅ フッターが「v2.5」になっている
2. ✅ 表形式の出力が増えた
3. ✅ 自社スコアが記載されるようになった
4. ✅ 警告メッセージが減った
```

### 次のステップ

```
1. v2.5をデプロイ
2. 複数回テスト実行（AIの出力は毎回異なる）
3. 結果を確認
4. 必要に応じて入力データを充実
5. さらなる改善が必要ならv2.6へ
```

---

**作成日**: 2026年1月19日  
**バージョン**: v2.5 (Few-Shot Examples強化版)  
**重要度**: 最高 - Few-Shot Learningは非常に効果的な手法です
