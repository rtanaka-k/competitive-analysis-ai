# 競合分析AI v2.3 - 表形式強制・自社スコア必須化版

## 🔧 修正内容

### 問題1: 自社スコアが空欄 ❌
### 問題2: 表形式ではなくテキスト形式 ❌

---

## ✅ 修正完了

### 1. 表形式の強制

**Before（プロンプト）**:
```
**必ず以下の表形式で出力（箇条書き禁止）**:
```

**After（プロンプト）**:
```
**【重要】以下は必ずMarkdown表形式で出力してください。箇条書き・テキスト形式は禁止です**

**表の出力例**:
| 項目 | FGO | モンスターストライク |
|------|-----|-------------------|
| 推定年間売上 | 950億円（市場データ） | 800億円（市場データ） |
```

**効果**:
- より明確な指示
- 出力例の追加
- 全セクションに適用

---

### 2. 自社スコアの必須化

**Before（評価根拠）**:
```
| 評価軸 | 競合スコア | 根拠 | 自社スコア | 根拠 |
|-------|----------|------|----------|------|
| 市場ポジション | XX点 | • 要素1<br>• 要素2 | XX点 | • [要素1]<br>• [要素2] |
```
→ AIが自社の[要素1]を空欄にしていた

**After（評価根拠）**:
```
| 評価軸 | 競合スコア | 根拠 | 自社スコア | 根拠 |
|-------|----------|------|----------|------|
| 市場ポジション | XX点 | • 要素1<br>• 要素2 | XX点 | • [例：初期ユーザー目標XX万人]<br>• [例：独自性による差別化] |
```

**追加指示**:
```
**重要**: 
- 自社（{our_product}）が新規タイトルの場合は、「目標」「計画」「想定」という形で記載すること
- 空欄は絶対に禁止。必ず何かしらの根拠を記載すること
```

---

### 3. 全セクションに適用

修正したセクション：
```
✅ COMPARISON_METRICS（レーダーチャート用JSON）
✅ 各評価の根拠（5軸表）
✅ 市場規模とトレンド
✅ ジャンル特性
✅ ビジネスモデル比較
✅ 強み・弱み比較
✅ 主要ギャップ分析
✅ 差別化戦略
✅ 短期施策（3ヶ月）
✅ 中期施策（6-12ヶ月）
✅ リスク分析
✅ 市場機会
✅ データソース
```

---

## 📋 重要指示の強化

### Before
```
2. 全てのセクションで必ず表形式（Markdownテーブル）を使用
3. 箇条書き（-や•）は使用禁止
```

### After
```
2. **全てのセクションで必ず表形式（Markdownテーブル）を使用。箇条書き（-や•）・単なるテキスト形式は絶対禁止**
3. **表の例**: `| 項目 | 競合 | 自社 |` という形式を必ず使用すること
11. **{our_product}（自社タイトル）のスコア・根拠も必ず記載すること。空欄は絶対禁止**
```

---

## 🎯 期待される改善

### Before（画像2の状態）

```
■ # 市場規模とトレンド

| 項目 | FGO | モンスターストライク |
|------|-----|-------------------|
...（省略）...

| ジャンル適合度 | 高：RPGは市場シェア28% |
| 差別化ポイント | 重厚なストーリー・キャラクター性 |
...（テキスト形式）
```

### After（期待される出力）

```
## MARKET_ANALYSIS

### 市場規模とトレンド

| 項目 | FGO | モンスターストライク |
|------|-----|-------------------|
| 推定年間売上 | 950億円（市場データ） | 800億円（市場データ） |
| 市場ランキング | TOP 3（年間・国内モバイル） | TOP 5（年間・国内モバイル） |
| DAU/MAU | 150万人/400万人（推定） | 200万人/800万人（推定） |
| 主要ターゲット層 | 20-40代男性 | 10-50代男女 |
| 市場シェア | 2.5%（推定） | 3.1%（推定） |

### ジャンル特性

| 特性項目 | FGO | モンスターストライク |
|----------|-----|-------------------|
| ジャンル適合度 | 高：RPGは市場シェア28% | 高：パズルは市場シェア15%で安定需要 |
| 差別化ポイント | 重厚なストーリー・キャラクター性 | 協力プレイ・親しみやすいキャラ |
| CPI | 1,200円（RPG平均） | 500円（パズル平均より低い） |
| 主要収益モデル | ガチャ（星5キャラ0.8%確率） | ガチャ（限定キャラ多数） |
```

**すべて表形式！**

---

## 🚀 デプロイ手順

### Step 1: GitHubにプッシュ

```bash
# 修正版をコピー
cp competitive_analysis_dual_full.py competitive_analysis_fixed.py

# コミット
git add competitive_analysis_fixed.py
git commit -m "v2.3: 表形式強制・自社スコア必須化"
git push
```

### Step 2: Streamlit Cloudで再起動

```
1. https://share.streamlit.io/
2. アプリを開く
3. 「⋮」→「Reboot app」
```

### Step 3: 動作確認

```
✅ レーダーチャート表示
✅ 詳細スコア比較（自社列にデータあり）
✅ 市場規模とトレンド（表形式）
✅ ジャンル特性（表形式）
✅ ビジネスモデル比較（表形式）
✅ 強み・弱み比較（表形式）
✅ 全セクションが表形式
```

---

## 📊 Before / After 比較

### レーダーチャート

**Before**:
```
FGO: 表示あり
モンスターストライク: データなし（空欄）
```

**After**:
```
FGO: 表示あり
モンスターストライク: データあり（目標値）
```

### 詳細スコア比較

**Before**:
```
| 評価項目 | FGO | モンスターストライク | 差分 |
|---------|-----|---------------------|------|
| 市場ポジション | 85 |  | - |
| 収益性 | 80 |  | - |
```

**After**:
```
| 評価項目 | FGO | モンスターストライク | 差分 |
|---------|-----|---------------------|------|
| 市場ポジション | 85 | 88 | -3 |
| 収益性 | 80 | 85 | -5 |
```

### 各セクション

**Before**: テキスト形式・箇条書き

**After**: すべて表形式

---

## 🎯 AIがより従う理由

### 1. 明確な指示

```
Before: 「必ず表形式で」
After: 「【重要】以下は必ずMarkdown表形式で出力してください。箇条書き・テキスト形式は禁止です」
```

### 2. 出力例の追加

```
**表の出力例**:
| 項目 | FGO | モンスターストライク |
|------|-----|-------------------|
| 推定年間売上 | 950億円（市場データ） | 800億円（市場データ） |
```

### 3. 自社データの例示

```
Before: | 自社スコア | XX点 | • [要素1]<br>• [要素2] |
After:  | 自社スコア | XX点 | • [例：初期ユーザー目標XX万人]<br>• [例：独自性による差別化] |
```

### 4. 禁止事項の明確化

```
11. **{our_product}（自社タイトル）のスコア・根拠も必ず記載すること。空欄は絶対禁止**
```

---

## 🔍 トラブルシューティング

### Q1: まだテキスト形式で出力される

**原因**: AIが指示を無視している

**対策**:
1. 分析を再実行（別の結果になる可能性あり）
2. より具体的な入力（既知データを多く入力）
3. プロンプトをさらに強化

### Q2: 自社スコアが依然として空欄

**原因**: 入力データ不足

**対策**:
1. 「自社タイトル情報」により詳細に入力
2. 「売上目標」「DAU/MAU目標」を必ず入力
3. 「詳細情報」に自社の強み・特徴を記載

### Q3: 一部は表形式、一部はテキスト形式

**原因**: セクションごとにAIの解釈が異なる

**解決**: 
- 今回の修正で全セクションに「【重要】表形式で」を追加済み
- 次回の分析から改善されるはず

---

## 📈 今後の改善案

### さらなる強化（必要に応じて）

1. **システムプロンプトに追加**
   ```python
   system=[
       {
           "type": "text",
           "text": "あなたは表形式での出力を得意とする専門家です。すべての情報は必ずMarkdown表形式で出力してください。"
       },
       ...
   ]
   ```

2. **出力後のポストプロセス**
   ```python
   # テキスト形式を検出して警告
   if "| " not in result:
       st.warning("表形式が検出されませんでした。再実行を推奨します。")
   ```

3. **Few-shot examples追加**
   ```
   プロンプトに実際の出力例を複数追加
   ```

---

## 🎉 まとめ

### 修正内容

```
1. ✅ すべてのセクションに「【重要】表形式で」を追加
2. ✅ 出力例を明示
3. ✅ 自社データの例示追加
4. ✅ 空欄禁止を明記
5. ✅ 重要指示に第11項を追加
```

### 期待される効果

```
✅ すべてのセクションが表形式
✅ 自社スコアが必ず記載される
✅ より読みやすく、データ比較が容易
✅ レーダーチャートと表の一貫性
```

---

**作成日**: 2026年1月19日  
**バージョン**: v2.3 (表形式強制・自社スコア必須化版)
